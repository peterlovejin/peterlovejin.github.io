```
---------------------------------------------------------------------
```{r ,echo=F,warning=F,message=F,error=F,fig.width=9,fig.height=9}
yes=read.csv("stack_update.csv",encoding = "BIG5")
library(tidyverse)
aa=rbind(full,yes[,-1])
if(!identical(unique(aa$date),unique(yes$date))){write.csv(aa,"stack_update.csv")}
aa=na.omit(aa)
aa %>% group_by(stake,name) %>% summarise(t=sum(total))%>% group_by(stake)%>%arrange(stake,-t)%>% datatable(options = list(autoWidth=T,
columnDefs = list(list(width = '100px',className = 'dt-center', targets = '_all'))))
```
---------------------------------------------------------------------
### 當日主力top 5買賣分析
```{r ,echo=F,warning=F,message=F,error=F,fig.width=9,fig.height=9}
library(lubridate)
#
#
# j=unique(full$stake)
#
#
#
#
#
# for (x in j){
#
#   print(full %>% filter(total>1 | total<(-1))%>%filter(stake==x) %>%  arrange(total) %>% ggplot()+geom_bar(aes(date,total,fill=ifelse(total>0,"blue","red")),stat="identity")+theme(axis.text.x=element_text(angle = 0,size=8))+geom_hline(yintercept = 0)+facet_wrap(name~.,ncol=5)+labs(title=x) +theme(legend.position = "none")
# )
# }
```
---------------------------------------------------------------------
```{r ,echo=F,warning=F,message=F,error=F,fig.width=10,fig.height=7}
tday=format(Sys.Date(),"%Y%m%d")
full1=na.omit(full)
j=unique(full$stake)
for (x in j){
#
#
# url=paste0("https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=html&date=",tday,"&stockNo=",str_sub(x,1,4))
#
#
#
# page=read_html(url)
#
#
#
# p1=page %>% html_table()%>% .[[1]]
#
#
#
# p2=p1%>% names()
#
# tt=unique(str_squish(p2))
#
# names(p1)=p1[1,]
#
# p1=p1[-1,]
# p1$date=as.Date(p1$日期)
#
# p1$p=as.numeric(p1$收盤價)
# p1$h= as.numeric(p1$最高價)
# p1$l= as.numeric(p1$最低價)
#
#
# print(ggplot(p1)+geom_line(aes(date,h),lty=2,col="blue")+geom_line(aes(date,l),lty=2,col="red")+geom_line(aes(date,p))  +labs(title=tt,y="",x=""))
#
#
# p1$price=scale(as.numeric(p1$收盤價))
#
# p1$high=scale(as.numeric(p1$最高價))
# p1$low=scale(as.numeric(p1$最低價))
# p1$q=scale(as.numeric(str_remove_all(p1$成交股數,",")))
#
#
# print(ggplot(p1)+geom_line(aes(date,high),lty=2,col="blue")+geom_line(aes(date,low),lty=2,col="red")+geom_line(aes(date,price))+geom_bar(aes(date,q),stat="identity",alpha=.3)+geom_hline(yintercept = 0)+labs(title=tt,y="",x=""))
#
#
print(x)
myprice=myview(str_extract(x,"[0-9L]+"))
print(myprice)
print(full1 %>%filter(stake==x)  %>% ggplot()+geom_bar(aes(reorder(name,total),total,fill=ifelse(total>0,"blue","red")),stat="identity",position = "dodge")+geom_hline(yintercept=0)+theme(axis.text.x=element_text(angle = 0,size=8))+geom_hline(yintercept = 0)+labs(title=paste(x,"@",dd,myprice[1],myprice[3]),y="",x="") +theme(legend.position = "none")+coord_flip()) }
x
str_extract(x,"[0-9L]+")
myview("2542")
myview("2390")
myview("2510")
myview("2540")
myview("2541")
myview("2543")
myview("2542")
myview("2549")
myview("2548")
myview("2538")
myview("2510")
myview("2501")
library("rmarkdown")
setwd("/home/peter/mygit/peterlovejin.github.io")
#install.packages("kableExtra")
#install.packages("tidyverse")
library(knitr)
library(kableExtra)
library(DT)
library(tidyverse)
library(rvest)
library(stringr)
#library(quantmod)
library(tidyr)
#library(devtools)
#devtools::install_github("joshuaulrich/quantmod")
full=NULL
myview=function(x) {url2=paste0("https://goodinfo.tw/StockInfo/DayTrading.asp?STOCK_ID=",x)
xxx=url2 %>% read_html()
ttt=xxx %>% html_table()
return(as.character(ttt[[11]][5,c(1,3,4,5)]))
}
my=c("2390","6180","1570","2727","3679","6207","2841","5410","2929" ,"1570","8112","2363","6226","8936","8941","00715L","6246","1340","2888","1540","6205","2883","1471","5521","2867")
tryCatch( for (i in my){
wp=NULL
page=NULL
wp1=NULL
wp2=NULL
stake=NULL
date=NULL
tmp=NULL
Sys.sleep(1)
url=paste0("https://tw.stock.yahoo.com/d/s/major_",i,".html")
page=url %>% read_html(encoding="BIG5")
wp=page%>%html_nodes("table")%>%html_nodes("td") %>%html_text()
wp1=str_squish(wp)
wp2=wp1[16:135]
stake=str_extract(wp1[1],"[\\w]+")
date=str_remove_all(str_extract(wp1[5],"[0-9/ ]+")," ")
date1=paste0(as.integer(str_sub(date,1,3))+1911,str_sub(date,4,9))
holder=stake
#assign(holder,getSymbols(paste0(i,".TW"),auto.assign=F,from="2021-01-01",to=date1))
name=wp2[seq(1,120,4)]
buy=as.integer(wp2[seq(2,120,4)])
sell=as.integer(wp2[seq(3,120,4)])
total=as.integer(wp2[seq(4,120,4)])
#price=as.numeric(myview(i)[4,1])
tmp=data.frame(stake,date,name,buy,sell,total)
full=rbind(tmp,full)
},warning = function(war){
print(paste("MY_WARNING:  ",war)) #如果有warning則輸出warning,"MY_WARNING:  "這一行可以自己改
},error = function(err) {
print(paste("MY_ERROR:  ",err))   #如果有error則輸出error,"MY_Error:  "這一行可以自己改
}
# ,finally = {
#   print(paste("End Try&Catch")) #最後一定要執行的指令或輸出
# }
)
dd=str_replace_all(unique(date),"/","-")
write.csv(full,paste0("stack_",dd,".csv"))
#full %>% group_by(stake) %>% summarise(t=sum(total))
#bb=read.csv("stack_110-07-07.csv")
#f2=read.csv("D:/test2/rhandsontable/vignettes/stack_110-07-06.csv")
#aa=rbind(full,f2[,-1],bb[,-1])
na.omit(full) %>% group_by(stake) %>% summarise(t=sum(total)) %>% kable(caption=dd) %>%
kable_classic( html_font = "Cambria",c("striped", "hover","condensed"),full_width=F,font_size=20) %>%
column_spec(1:2,width="3.5cm")
#
#
# url=paste0("https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=html&date=",tday,"&stockNo=",str_sub(x,1,4))
#
#
#
# page=read_html(url)
#
#
#
# p1=page %>% html_table()%>% .[[1]]
#
#
#
# p2=p1%>% names()
#
# tt=unique(str_squish(p2))
#
# names(p1)=p1[1,]
#
# p1=p1[-1,]
# p1$date=as.Date(p1$日期)
#
# p1$p=as.numeric(p1$收盤價)
# p1$h= as.numeric(p1$最高價)
# p1$l= as.numeric(p1$最低價)
#
#
# print(ggplot(p1)+geom_line(aes(date,h),lty=2,col="blue")+geom_line(aes(date,l),lty=2,col="red")+geom_line(aes(date,p))  +labs(title=tt,y="",x=""))
#
#
# p1$price=scale(as.numeric(p1$收盤價))
#
# p1$high=scale(as.numeric(p1$最高價))
# p1$low=scale(as.numeric(p1$最低價))
# p1$q=scale(as.numeric(str_remove_all(p1$成交股數,",")))
#
#
# print(ggplot(p1)+geom_line(aes(date,high),lty=2,col="blue")+geom_line(aes(date,low),lty=2,col="red")+geom_line(aes(date,price))+geom_bar(aes(date,q),stat="identity",alpha=.3)+geom_hline(yintercept = 0)+labs(title=tt,y="",x=""))
#
#
```
公開資訊
---------------------------------------------------------------------
```{r ,echo=F,warning=F,message=F,error=F,fig.width=9,fig.height=9}
url="https://www.twse.com.tw/exchangeReport/BFT41U?response=html&date=20210726&selectType=ALL"
library(rvest)
tmp1=read_html(url) %>% html_table() %>% .[[1]]
topic=names(tmp1)[1]
names(tmp1)=tmp1[1,]
tmp1=tmp1[-1,]
```
---------------------------------------------------------------------
```{r ,echo=F,warning=F,message=F,error=F,fig.width=9,fig.height=9}
yes=read.csv("stack_update.csv",encoding = "BIG5")
library(tidyverse)
aa=rbind(full,yes[,-1])
if(!identical(unique(aa$date),unique(yes$date))){write.csv(aa,"stack_update.csv")}
aa=na.omit(aa)
aa %>% group_by(stake,name) %>% summarise(t=sum(total))%>% group_by(stake)%>%arrange(stake,-t)%>% datatable(options = list(autoWidth=T,
columnDefs = list(list(width = '100px',className = 'dt-center', targets = '_all'))))
```
---------------------------------------------------------------------
### 當日主力top 5買賣分析
```{r ,echo=F,warning=F,message=F,error=F,fig.width=9,fig.height=9}
library(lubridate)
#
#
# j=unique(full$stake)
#
#
#
#
#
# for (x in j){
#
#   print(full %>% filter(total>1 | total<(-1))%>%filter(stake==x) %>%  arrange(total) %>% ggplot()+geom_bar(aes(date,total,fill=ifelse(total>0,"blue","red")),stat="identity")+theme(axis.text.x=element_text(angle = 0,size=8))+geom_hline(yintercept = 0)+facet_wrap(name~.,ncol=5)+labs(title=x) +theme(legend.position = "none")
# )
# }
```
---------------------------------------------------------------------
```{r ,echo=F,warning=F,message=F,error=F,fig.width=10,fig.height=7}
tday=format(Sys.Date(),"%Y%m%d")
full1=na.omit(full)
j=unique(full$stake)
for (x in j){
#
#
# url=paste0("https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=html&date=",tday,"&stockNo=",str_sub(x,1,4))
#
#
#
# page=read_html(url)
#
#
#
# p1=page %>% html_table()%>% .[[1]]
#
#
#
# p2=p1%>% names()
#
# tt=unique(str_squish(p2))
#
# names(p1)=p1[1,]
#
# p1=p1[-1,]
# p1$date=as.Date(p1$日期)
#
# p1$p=as.numeric(p1$收盤價)
# p1$h= as.numeric(p1$最高價)
# p1$l= as.numeric(p1$最低價)
#
#
# print(ggplot(p1)+geom_line(aes(date,h),lty=2,col="blue")+geom_line(aes(date,l),lty=2,col="red")+geom_line(aes(date,p))  +labs(title=tt,y="",x=""))
#
#
# p1$price=scale(as.numeric(p1$收盤價))
#
# p1$high=scale(as.numeric(p1$最高價))
# p1$low=scale(as.numeric(p1$最低價))
# p1$q=scale(as.numeric(str_remove_all(p1$成交股數,",")))
#
#
# print(ggplot(p1)+geom_line(aes(date,high),lty=2,col="blue")+geom_line(aes(date,low),lty=2,col="red")+geom_line(aes(date,price))+geom_bar(aes(date,q),stat="identity",alpha=.3)+geom_hline(yintercept = 0)+labs(title=tt,y="",x=""))
#
#
myprice=myview(str_extract(x,"[0-9L]+"))
print(full1 %>%filter(stake==x)  %>% ggplot()+geom_bar(aes(reorder(name,total),total,fill=ifelse(total>0,"blue","red")),stat="identity",position = "dodge")+geom_hline(yintercept=0)+theme(axis.text.x=element_text(angle = 0,size=8))+geom_hline(yintercept = 0)+labs(title=paste(x,"@",dd,myprice[1],myprice[3]),y="",x="") +theme(legend.position = "none")+coord_flip()) }
myview("2542")
myview("2390")[1]
myview("2510")
myview("2501")
xx=myview("2501")
xx=NULL
xx=myview("2501")
xx[1]
xx=myview("2390")
xx=NULL
xx=myview("2390")
library("rmarkdown")
setwd("/home/peter/mygit/peterlovejin.github.io")
#install.packages("kableExtra")
#install.packages("tidyverse")
library(knitr)
library(kableExtra)
library(DT)
library(tidyverse)
library(rvest)
library(stringr)
#library(quantmod)
library(tidyr)
#library(devtools)
#devtools::install_github("joshuaulrich/quantmod")
full=NULL
myview=function(x) {url2=paste0("https://goodinfo.tw/StockInfo/DayTrading.asp?STOCK_ID=",x)
xxx=url2 %>% read_html()
ttt=xxx %>% html_table()
return(as.character(ttt[[11]][5,c(1,3,4,5)]))
}
my=c("2390","6180","1570","2727","3679","6207","2841","5410","2929" ,"1570","8112","2363","6226","8936","8941","00715L","6246","1340","2888","1540","6205","2883","1471","5521","2867")
tryCatch( for (i in my){
wp=NULL
page=NULL
wp1=NULL
wp2=NULL
stake=NULL
date=NULL
tmp=NULL
Sys.sleep(1)
url=paste0("https://tw.stock.yahoo.com/d/s/major_",i,".html")
page=url %>% read_html(encoding="BIG5")
wp=page%>%html_nodes("table")%>%html_nodes("td") %>%html_text()
wp1=str_squish(wp)
wp2=wp1[16:135]
stake=str_extract(wp1[1],"[\\w]+")
date=str_remove_all(str_extract(wp1[5],"[0-9/ ]+")," ")
date1=paste0(as.integer(str_sub(date,1,3))+1911,str_sub(date,4,9))
holder=stake
#assign(holder,getSymbols(paste0(i,".TW"),auto.assign=F,from="2021-01-01",to=date1))
name=wp2[seq(1,120,4)]
buy=as.integer(wp2[seq(2,120,4)])
sell=as.integer(wp2[seq(3,120,4)])
total=as.integer(wp2[seq(4,120,4)])
#price=as.numeric(myview(i)[4,1])
tmp=data.frame(stake,date,name,buy,sell,total)
full=rbind(tmp,full)
},warning = function(war){
print(paste("MY_WARNING:  ",war)) #如果有warning則輸出warning,"MY_WARNING:  "這一行可以自己改
},error = function(err) {
print(paste("MY_ERROR:  ",err))   #如果有error則輸出error,"MY_Error:  "這一行可以自己改
}
# ,finally = {
#   print(paste("End Try&Catch")) #最後一定要執行的指令或輸出
# }
)
dd=str_replace_all(unique(date),"/","-")
write.csv(full,paste0("stack_",dd,".csv"))
#full %>% group_by(stake) %>% summarise(t=sum(total))
#bb=read.csv("stack_110-07-07.csv")
#f2=read.csv("D:/test2/rhandsontable/vignettes/stack_110-07-06.csv")
#aa=rbind(full,f2[,-1],bb[,-1])
na.omit(full) %>% group_by(stake) %>% summarise(t=sum(total)) %>% kable(caption=dd) %>%
kable_classic( html_font = "Cambria",c("striped", "hover","condensed"),full_width=F,font_size=20) %>%
column_spec(1:2,width="3.5cm")
#
#
# url=paste0("https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=html&date=",tday,"&stockNo=",str_sub(x,1,4))
#
#
#
# page=read_html(url)
#
#
#
# p1=page %>% html_table()%>% .[[1]]
#
#
#
# p2=p1%>% names()
#
# tt=unique(str_squish(p2))
#
# names(p1)=p1[1,]
#
# p1=p1[-1,]
# p1$date=as.Date(p1$日期)
#
# p1$p=as.numeric(p1$收盤價)
# p1$h= as.numeric(p1$最高價)
# p1$l= as.numeric(p1$最低價)
#
#
# print(ggplot(p1)+geom_line(aes(date,h),lty=2,col="blue")+geom_line(aes(date,l),lty=2,col="red")+geom_line(aes(date,p))  +labs(title=tt,y="",x=""))
#
#
# p1$price=scale(as.numeric(p1$收盤價))
#
# p1$high=scale(as.numeric(p1$最高價))
# p1$low=scale(as.numeric(p1$最低價))
# p1$q=scale(as.numeric(str_remove_all(p1$成交股數,",")))
#
#
# print(ggplot(p1)+geom_line(aes(date,high),lty=2,col="blue")+geom_line(aes(date,low),lty=2,col="red")+geom_line(aes(date,price))+geom_bar(aes(date,q),stat="identity",alpha=.3)+geom_hline(yintercept = 0)+labs(title=tt,y="",x=""))
#
#
```
公開資訊
---------------------------------------------------------------------
```{r ,echo=F,warning=F,message=F,error=F,fig.width=9,fig.height=9}
url="https://www.twse.com.tw/exchangeReport/BFT41U?response=html&date=20210726&selectType=ALL"
library(rvest)
tmp1=read_html(url) %>% html_table() %>% .[[1]]
topic=names(tmp1)[1]
names(tmp1)=tmp1[1,]
tmp1=tmp1[-1,]
```
---------------------------------------------------------------------
```{r ,echo=F,warning=F,message=F,error=F,fig.width=9,fig.height=9}
yes=read.csv("stack_update.csv",encoding = "BIG5")
library(tidyverse)
aa=rbind(full,yes[,-1])
if(!identical(unique(aa$date),unique(yes$date))){write.csv(aa,"stack_update.csv")}
aa=na.omit(aa)
aa %>% group_by(stake,name) %>% summarise(t=sum(total))%>% group_by(stake)%>%arrange(stake,-t)%>% datatable(options = list(autoWidth=T,
columnDefs = list(list(width = '100px',className = 'dt-center', targets = '_all'))))
```
---------------------------------------------------------------------
### 當日主力top 5買賣分析
```{r ,echo=F,warning=F,message=F,error=F,fig.width=9,fig.height=9}
library(lubridate)
#
#
# j=unique(full$stake)
#
#
#
#
#
# for (x in j){
#
#   print(full %>% filter(total>1 | total<(-1))%>%filter(stake==x) %>%  arrange(total) %>% ggplot()+geom_bar(aes(date,total,fill=ifelse(total>0,"blue","red")),stat="identity")+theme(axis.text.x=element_text(angle = 0,size=8))+geom_hline(yintercept = 0)+facet_wrap(name~.,ncol=5)+labs(title=x) +theme(legend.position = "none")
# )
# }
```
---------------------------------------------------------------------
```{r ,echo=F,warning=F,message=F,error=F,fig.width=10,fig.height=7}
tday=format(Sys.Date(),"%Y%m%d")
full1=na.omit(full)
j=unique(full$stake)
for (x in j){
#
#
# url=paste0("https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=html&date=",tday,"&stockNo=",str_sub(x,1,4))
#
#
#
# page=read_html(url)
#
#
#
# p1=page %>% html_table()%>% .[[1]]
#
#
#
# p2=p1%>% names()
#
# tt=unique(str_squish(p2))
#
# names(p1)=p1[1,]
#
# p1=p1[-1,]
# p1$date=as.Date(p1$日期)
#
# p1$p=as.numeric(p1$收盤價)
# p1$h= as.numeric(p1$最高價)
# p1$l= as.numeric(p1$最低價)
#
#
# print(ggplot(p1)+geom_line(aes(date,h),lty=2,col="blue")+geom_line(aes(date,l),lty=2,col="red")+geom_line(aes(date,p))  +labs(title=tt,y="",x=""))
#
#
# p1$price=scale(as.numeric(p1$收盤價))
#
# p1$high=scale(as.numeric(p1$最高價))
# p1$low=scale(as.numeric(p1$最低價))
# p1$q=scale(as.numeric(str_remove_all(p1$成交股數,",")))
#
#
# print(ggplot(p1)+geom_line(aes(date,high),lty=2,col="blue")+geom_line(aes(date,low),lty=2,col="red")+geom_line(aes(date,price))+geom_bar(aes(date,q),stat="identity",alpha=.3)+geom_hline(yintercept = 0)+labs(title=tt,y="",x=""))
#
#
print(x)
print(str_extract(x,"[0-9L]+"))
myprice=NULL
myprice=myview(str_extract(x,"[0-9L]+"))
print(myprice)
Sys.sleep(10)
print(full1 %>%filter(stake==x)  %>% ggplot()+geom_bar(aes(reorder(name,total),total,fill=ifelse(total>0,"blue","red")),stat="identity",position = "dodge")+geom_hline(yintercept=0)+theme(axis.text.x=element_text(angle = 0,size=8))+geom_hline(yintercept = 0)+labs(title=paste(x,"@",dd,myprice[1],myprice[3]),y="",x="") +theme(legend.position = "none")+coord_flip()) }
print("123")
for (i in 1:3){
Sys.sleep(10)
print("123")
}
myview("2349")
library(RODBC)
install.packages("ROCBD")
install.packages("RODBC")
install.packages("RODBC")
install.packages("RODBC")
library(RODBC)
install.packages("RODBC")
install.packages("RODBC")
